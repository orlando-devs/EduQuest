import React from 'react';
import {
    BookOpen, Home, FileText, Clock, Settings, Moon, Sun, CheckCircle, TrendingUp, Key, ShieldAlert, Bell
} from 'lucide-react';

export default function StudentDash({
    appUser, studentTab, setStudentTab, darkMode, setDarkMode, studentHistory,
    handleJoinQuiz, roomCode, setRoomCode, errorMsg, handleLogout
}) {
    const themeClass = darkMode ? "bg-slate-900 text-slate-100" : "bg-slate-50 text-slate-800";
    const cardClass = darkMode ? "bg-slate-800 border-slate-700 shadow-slate-900/50" : "bg-white border-slate-200 shadow-sm";
    const textMuted = darkMode ? "text-slate-400" : "text-slate-500";
    const headingColor = darkMode ? "text-white" : "text-slate-800";

    return (
        <div className={`min-h-screen font-sans flex transition-colors duration-300 ${themeClass}`}>
            <aside className={`w-64 border-r flex flex-col sticky top-0 h-screen z-20 transition-colors duration-300 ${darkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>
                <div className={`p-6 flex items-center gap-3 border-b ${darkMode ? 'border-slate-800' : 'border-slate-100'}`}><div className="bg-blue-600 text-white p-2 rounded-xl shadow-lg"><BookOpen size={20} /></div><span className={`font-extrabold text-lg ${headingColor}`}>EduQuest</span></div>
                <div className="p-4 space-y-2"><div className={`text-xs font-bold uppercase tracking-widest px-4 mb-2 mt-4 ${textMuted}`}>Menu</div><button onClick={() => setStudentTab('dashboard')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-bold transition-all ${studentTab === 'dashboard' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : `${textMuted} hover:bg-slate-100 dark:hover:bg-slate-800`}`}><Home size={18} /> Dashboard</button><button onClick={() => setStudentTab('results')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${studentTab === 'results' ? 'bg-blue-600 text-white shadow-lg' : `${textMuted} hover:bg-slate-100 dark:hover:bg-slate-800`}`}><FileText size={18} /> Hasil Ujian</button><button onClick={() => setStudentTab('activity')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${studentTab === 'activity' ? 'bg-blue-600 text-white shadow-lg' : `${textMuted} hover:bg-slate-100 dark:hover:bg-slate-800`}`}><Clock size={18} /> Aktivitas</button><button onClick={() => setStudentTab('settings')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${studentTab === 'settings' ? 'bg-blue-600 text-white shadow-lg' : `${textMuted} hover:bg-slate-100 dark:hover:bg-slate-800`}`}><Settings size={18} /> Pengaturan</button></div>
            </aside>
            <main className="flex-1 p-8 overflow-y-auto">
                <header className="flex justify-between items-center mb-8"><div><h1 className={`text-2xl font-extrabold ${headingColor}`}>Halo, {appUser?.name} ðŸ‘‹</h1><p className={`font-medium ${textMuted}`}>Kelas: {appUser?.classroom} â€¢ Selamat Belajar!</p></div><div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold border shadow-sm ${darkMode ? 'bg-slate-700 text-slate-200 border-slate-600' : 'bg-slate-200 text-slate-500 border-white'}`}>{appUser?.name.charAt(0)}</div></header>
                {studentTab === 'dashboard' && <div className="grid grid-cols-1 lg:grid-cols-3 gap-8"><div className="lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-4 mb-2"><div className={`p-6 rounded-2xl border shadow-sm flex items-center gap-4 ${cardClass}`}><div className="p-3 bg-blue-100 text-blue-600 rounded-xl"><CheckCircle size={24} /></div><div><p className={`text-sm font-bold uppercase ${textMuted}`}>Ujian Selesai</p><p className={`text-2xl font-extrabold ${headingColor}`}>{studentHistory.length}</p></div></div><div className={`p-6 rounded-2xl border shadow-sm flex items-center gap-4 ${cardClass}`}><div className="p-3 bg-green-100 text-green-600 rounded-xl"><TrendingUp size={24} /></div><div><p className={`text-sm font-bold uppercase ${textMuted}`}>Rata-rata Nilai</p><p className={`text-2xl font-extrabold ${headingColor}`}>{studentHistory.length > 0 ? Math.round(studentHistory.reduce((a, b) => a + b.score, 0) / studentHistory.length) : 0}</p></div></div><div className={`p-6 rounded-2xl border shadow-sm flex items-center gap-4 ${cardClass}`}><div className="p-3 bg-purple-100 text-purple-600 rounded-xl"><Clock size={24} /></div><div><p className={`text-sm font-bold uppercase ${textMuted}`}>Terakhir Aktif</p><p className={`text-sm font-bold ${headingColor}`}>{new Date().toLocaleDateString()}</p></div></div></div><div className="lg:col-span-2 space-y-6"><div className="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-[32px] p-8 text-white shadow-xl shadow-blue-500/20 relative overflow-hidden"><div className="relative z-10"><h2 className="text-3xl font-extrabold mb-2">Siap Ujian?</h2><p className="text-blue-100 mb-6 font-medium">Masukkan kode unik dari gurumu untuk mulai.</p><form onSubmit={handleJoinQuiz} className="flex gap-2"><div className="relative flex-1 group"><Key className="absolute left-4 top-4 text-slate-400" size={20} /><input className="w-full pl-12 pr-4 py-4 rounded-xl text-slate-800 font-mono text-xl font-bold uppercase tracking-widest outline-none focus:ring-4 focus:ring-blue-400/50 transition bg-white" placeholder="KODE..." maxLength={6} value={roomCode} onChange={e => setRoomCode(e.target.value.toUpperCase())} /></div><button type="submit" className="bg-slate-900 hover:bg-black text-white font-bold px-8 rounded-xl transition shadow-lg">MASUK</button></form>{errorMsg && <div className="mt-4 bg-red-500/20 border border-red-400/30 text-white px-4 py-2 rounded-lg font-bold text-sm inline-flex items-center gap-2"><ShieldAlert size={14} /> {errorMsg}</div>}</div><div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -mr-16 -mt-16"></div></div></div><div className="space-y-6"><div className="bg-amber-50 p-6 rounded-[24px] border border-amber-100"><div className="flex items-center gap-2 mb-2 text-amber-700 font-bold"><Bell size={18} /> Pengumuman</div><p className="text-sm text-amber-800 leading-relaxed">Jangan lupa mengecek jadwal ujian semester depan. Tetap semangat belajar!</p></div></div></div>}
                {studentTab === 'results' && <div className={`rounded-[24px] border overflow-hidden ${cardClass}`}><div className={`p-6 border-b flex justify-between items-center ${darkMode ? 'border-slate-700' : 'border-slate-100'}`}><h3 className={`font-bold text-lg ${headingColor}`}>Daftar Nilai Ujian</h3></div><table className="w-full text-left"><thead className={`text-xs font-bold uppercase border-b ${darkMode ? 'bg-slate-800 text-slate-400 border-slate-700' : 'bg-slate-50 text-slate-500 border-slate-100'}`}><tr><th className="px-6 py-4">Judul Quiz</th><th className="px-6 py-4">Kode</th><th className="px-6 py-4">Tanggal</th><th className="px-6 py-4 text-right">Nilai</th></tr></thead><tbody className={`divide-y text-sm ${darkMode ? 'divide-slate-700' : 'divide-slate-50'}`}>{studentHistory.length === 0 ? <tr><td colSpan="4" className={`p-8 text-center italic ${textMuted}`}>Belum ada data nilai.</td></tr> : studentHistory.map((h, i) => <tr key={i} className={`transition ${darkMode ? 'hover:bg-slate-700/50' : 'hover:bg-slate-50/50'}`}><td className={`px-6 py-4 font-bold ${headingColor}`}>{h.quizTitle}</td><td className={`px-6 py-4 font-mono ${textMuted}`}>{h.quizCode}</td><td className={`px-6 py-4 ${textMuted}`}>{h.timestamp ? new Date(h.timestamp.seconds * 1000).toLocaleDateString() : '-'}</td><td className="px-6 py-4 text-right"><span className={`px-3 py-1 rounded-lg font-bold text-xs ${h.score >= 70 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{h.score}</span></td></tr>)}</tbody></table></div>}
                {studentTab === 'activity' && <div className="max-w-3xl"><h3 className={`font-bold text-lg mb-6 ${headingColor}`}>Timeline Aktivitas</h3><div className="space-y-6">{studentHistory.length === 0 ? <p className={textMuted}>Belum ada aktivitas tercatat.</p> : studentHistory.map((h, i) => <div key={i} className="flex gap-4"><div className="flex flex-col items-center"><div className={`w-3 h-3 rounded-full ${h.score >= 70 ? 'bg-green-500' : 'bg-blue-500'}`}></div>{i !== studentHistory.length - 1 && <div className={`w-0.5 flex-1 my-1 ${darkMode ? 'bg-slate-700' : 'bg-slate-200'}`}></div>}</div><div className={`flex-1 p-4 rounded-xl border ${cardClass}`}><div className="flex justify-between items-start"><div><h4 className={`font-bold ${headingColor}`}>{h.quizTitle}</h4><p className={`text-xs ${textMuted}`}>Menyelesaikan ujian dengan kode <span className="font-mono font-bold">{h.quizCode}</span></p></div><span className={`text-xs font-bold ${textMuted}`}>{h.timestamp ? new Date(h.timestamp.seconds * 1000).toLocaleDateString() : 'Baru saja'}</span></div></div></div>)}</div></div>}
                {studentTab === 'settings' && <div className="max-w-2xl space-y-6"><div className={`p-6 rounded-2xl border ${cardClass}`}><h3 className={`font-bold text-lg mb-4 ${headingColor}`}>Tampilan</h3><div className="flex items-center justify-between"><div className="flex items-center gap-3"><div className={`p-2 rounded-lg ${darkMode ? 'bg-slate-700 text-yellow-400' : 'bg-slate-100 text-slate-600'}`}>{darkMode ? <Moon size={20} /> : <Sun size={20} />}</div><div><p className={`font-bold ${headingColor}`}>Mode Gelap</p><p className={`text-xs ${textMuted}`}>Ganti tampilan antarmuka</p></div></div><button onClick={() => setDarkMode(!darkMode)} className={`w-12 h-6 rounded-full transition-colors relative ${darkMode ? 'bg-blue-600' : 'bg-slate-300'}`}><div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${darkMode ? 'left-7' : 'left-1'}`}></div></button></div></div><div className={`p-6 rounded-2xl border ${cardClass}`}><h3 className={`font-bold text-lg mb-4 ${headingColor}`}>Akun Saya</h3><div className="flex items-center gap-4 mb-6"><div className="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">{appUser?.name.charAt(0)}</div><div><p className={`font-bold text-lg ${headingColor}`}>{appUser?.name}</p><p className={`text-sm ${textMuted}`}>Siswa â€¢ Kelas {appUser?.classroom}</p></div></div><button onClick={handleLogout} className="w-full py-3 border border-red-200 text-red-500 font-bold rounded-xl hover:bg-red-50 transition">Keluar Aplikasi</button></div></div>}
            </main>
        </div>
    )
}
